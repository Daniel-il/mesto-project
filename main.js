(()=>{"use strict";var t=document.querySelector(".popup_type_add-card"),e=document.querySelector(".popup_type_image"),o=document.querySelector(".popup_type_profile"),n=document.querySelector(".form_type_add-card"),r=(document.querySelector(".form__submit-button"),document.querySelector(".profile__add-button")),c=document.querySelector(".profile__edit-button"),a=document.querySelector(".form__submit-button_type_card"),i=document.querySelector(".profile__avatar-overlay"),u=document.querySelector(".popup_type_avatar"),s=document.querySelector(".profile__avatar");function l(t,e,o){e.querySelector(".form__submit-button").textContent=t?"Сохранение...":o}var d=document.querySelector(".profile__column"),p=document.querySelector(".form__input-container"),m=d.querySelector(".profile__name"),f=d.querySelector(".profile__description"),_=document.querySelector(".form__item_el_avatar"),h=p.querySelector(".form__item_el_name"),v=p.querySelector(".form__item_el_description"),y=document.querySelector(".form_type_add-card"),S=document.querySelector(".form_type_profile"),b=document.querySelector(".form_type_avatar");function q(t){t.classList.add("popup_opened"),document.addEventListener("keydown",C)}function k(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",C)}function C(t){"Escape"===t.key&&k(document.querySelector(".popup_opened"))}var j=document.querySelector(".popup__image"),L=document.querySelector(".form__item_el_card-name"),E=document.querySelector(".form__item_el_link"),g=document.querySelector(".popup__image-description"),T=document.querySelector(".cards__list");function x(t){var o=document.querySelector("#card-adding").content.querySelector(".card").cloneNode(!0);return fetch("https://nomoreparties.co/v1/plus-cohort7/users/me",{headers:{authorization:"5b7f82d3-27ce-4c91-a980-7124a27c0a62","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)})).then((function(n){var r=o.querySelector(".card__heading"),c=o.querySelector(".card__image");r.textContent=t.name,c.alt=t.name,c.src=t.link;var a=o.querySelector(".card__delete-button");a.addEventListener("click",(function(){var e;a.closest(".card").remove(),e=t._id,fetch("https://nomoreparties.co/v1/plus-cohort7/cards/".concat(e),{method:"DELETE",headers:{authorization:"5b7f82d3-27ce-4c91-a980-7124a27c0a62","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}));var i=o.querySelector(".card__like-button");i.addEventListener("mousedown",(function(){var e;i.classList.contains("card__like-button_active")?(e=t._id,fetch("https://nomoreparties.co/v1/plus-cohort7/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:"5b7f82d3-27ce-4c91-a980-7124a27c0a62","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)})),i.classList.remove("card__like-button_active")):(i.classList.add("card__like-button_active"),function(t){fetch("https://nomoreparties.co/v1/plus-cohort7/cards/likes/".concat(t),{method:"PUT",headers:{authorization:"5b7f82d3-27ce-4c91-a980-7124a27c0a62","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}(t._id))}));var u=o.querySelector(".card__likes-count");fetch("https://nomoreparties.co/v1/plus-cohort7/cards",{method:"GET",headers:{authorization:"5b7f82d3-27ce-4c91-a980-7124a27c0a62","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)})).then((function(){var e=t.likes;u.textContent=e.length})),c.addEventListener("click",(function(){j.src=c.src,j.alt=c.alt,g.textContent=r.textContent,q(e)})),t.owner._id===n._id&&a.classList.add("card__delete-button_enable")})),o}var P,z=function(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(o.inactiveButtonClass),e.disabled=!1):(e.classList.add(o.inactiveButtonClass),e.disabled=!0)};b.addEventListener("submit",(function(t){var e;t.preventDefault(),s.src=_.value,e={link:s.src},l(!0,b,"Обновить"),fetch("https://nomoreparties.co/v1/plus-cohort7/users/me/avatar",{method:"PATCH",headers:{authorization:"5b7f82d3-27ce-4c91-a980-7124a27c0a62","Content-Type":"application/json"},body:JSON.stringify({avatar:e.link})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)})).finally((function(){l(!1,b,"Обновить")})),t.target.reset(),k(u)})),S.addEventListener("submit",(function(t){var e;l(!0,S,"Сохранить"),t.preventDefault(),m.textContent=h.value,f.textContent=v.value,e={name:m.textContent,about:f.textContent},l(!0,S,"Сохранить"),fetch("https://nomoreparties.co/v1/plus-cohort7/users/me",{method:"PATCH",headers:{authorization:"5b7f82d3-27ce-4c91-a980-7124a27c0a62","Content-Type":"application/json"},body:JSON.stringify({name:e.name,about:e.about})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)})).finally((function(){l(!1,S,"Сохранить")})),k(o)})),r.addEventListener("click",(function(){return q(t)})),c.addEventListener("click",(function(){q(o),h.value=m.textContent,v.value=f.textContent})),i.addEventListener("click",(function(){return q(u)})),n.addEventListener("submit",(function(e){e.preventDefault();var o,n={};n.name=L.value,n.link=E.value,o={name:n.name,link:n.link},l(!0,y,"Создать"),fetch("https://nomoreparties.co/v1/plus-cohort7/cards",{method:"POST",headers:{authorization:"5b7f82d3-27ce-4c91-a980-7124a27c0a62","Content-Type":"application/json"},body:JSON.stringify({name:o.name,link:o.link})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)})).finally((function(){l(!1,y,"Создать")})),T.prepend(x(n)),k(t),a.classList.add("form__submit-button_inactive"),a.disabled=!0,e.target.reset()})),document.querySelectorAll(".popup").forEach((function(t){t.addEventListener("mousedown",(function(e){e.target.classList.contains("popup_opened")&&k(t),e.target.classList.contains("popup__close-button")&&k(t)}))})),P={fieldset:".form__input-container",formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_inactive",inputErrorClass:"form__item_type_error",errorClass:"form__input-error_active"},Array.from(document.querySelectorAll(P.formSelector)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),Array.from(t.querySelectorAll(P.fieldset)).forEach((function(t){!function(t,e){var o=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);z(o,n,e),o.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,o){e.validity.valid&&0!==e.length?function(t,e,o){var n=t.querySelector(".".concat(e.id,"-error"));n.classList.remove(o.errorClass),n.textContent=""}(t,e,o):function(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));r.textContent=o,r.classList.add(n.errorClass)}(t,e,e.validationMessage,o)}(t,r,e),z(o,n,e)}))}))}(t,P)}))})),fetch("https://nomoreparties.co/v1/plus-cohort7/users/me",{headers:{authorization:"5b7f82d3-27ce-4c91-a980-7124a27c0a62","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){m.textContent=t.name,f.textContent=t.about,s.src=t.avatar})).catch((function(t){console.log(t)})),fetch("https://nomoreparties.co/v1/plus-cohort7/cards",{headers:{authorization:"5b7f82d3-27ce-4c91-a980-7124a27c0a62","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){Array.from(t).forEach((function(t){T.append(x(t))}))})).catch((function(t){console.log(t)}))})();