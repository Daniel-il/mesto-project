(()=>{"use strict";var e=document.querySelector(".popup_type_add-card"),t=document.querySelector(".popup_type_image"),n=document.querySelector(".popup_type_profile"),o=document.querySelector(".form_type_add-card"),r=(document.querySelector(".form__submit-button"),document.querySelector(".profile__add-button")),c=document.querySelector(".profile__edit-button"),a=document.querySelector(".form__submit-button_type_card"),u=document.querySelector(".profile__avatar-overlay"),i=document.querySelector(".popup_type_avatar"),s=document.querySelector(".profile__avatar"),l={baseUrl:"https://nomoreparties.co/v1/plus-cohort7",headers:{authorization:"5b7f82d3-27ce-4c91-a980-7124a27c0a62","Content-Type":"application/json"}};function d(e,t,n){t.querySelector(".form__submit-button").textContent=e?"Сохранение...":n}var f=document.querySelector(".profile__column"),_=document.querySelector(".form__input-container"),m=f.querySelector(".profile__name"),p=f.querySelector(".profile__description"),h=document.querySelector(".form__item_el_avatar"),v=_.querySelector(".form__item_el_name"),y=_.querySelector(".form__item_el_description"),S=document.querySelector(".form_type_add-card"),b=document.querySelector(".form_type_profile"),q=document.querySelector(".form_type_avatar");function k(e){e.classList.add("popup_opened"),document.addEventListener("keydown",E)}function L(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",E)}function E(e){"Escape"===e.key&&L(document.querySelector(".popup_opened"))}var g=document.querySelector(".popup__image"),C=document.querySelector(".form__item_el_card-name"),j=document.querySelector(".form__item_el_link"),x=document.querySelector(".popup__image-description"),P=document.querySelector(".cards__list");function U(e){var n=document.querySelector("#card-adding").content.querySelector(".card").cloneNode(!0);return fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(o){var r=n.querySelector(".card__heading"),c=n.querySelector(".card__image");r.textContent=e.name,c.alt=e.name,c.src=e.link;var a=n.querySelector(".card__delete-button");a.addEventListener("click",(function(){var t;a.closest(".card").remove(),t=e._id,fetch("".concat(l.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})),e.owner._id===o._id&&a.classList.add("card__delete-button_enable");var u=n.querySelector(".card__like-button"),i=n.querySelector(".card__likes-count");fetch("".concat(l.baseUrl,"/cards"),{method:"GET",headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(){var t=e.likes;i.textContent=t.length,t.some((function(e){return e._id===o._id}))&&u.classList.add("card__like-button_active")})).catch((function(e){return console.log(e)})),u.addEventListener("mousedown",(function(){var t;u.classList.contains("card__like-button_active")?((t=e._id,fetch("".concat(l.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var t=e.likes;i.textContent=t.length})).catch((function(e){return console.log(e)})),u.classList.remove("card__like-button_active")):(u.classList.add("card__like-button_active"),function(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e._id).then((function(e){var t=e.likes;i.textContent=t.length})).catch((function(e){return console.log(e)})))})),c.addEventListener("click",(function(){g.src=c.src,g.alt=c.alt,x.textContent=r.textContent,k(t)}))})).catch((function(e){return console.log(e)})),n}var A,T=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)};q.addEventListener("submit",(function(e){var t;d(!0,q,"Обновить"),e.preventDefault(),s.src=h.value,(t={link:s.src},fetch("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:t.link})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).catch((function(e){return console.log(e)})).finally((function(){d(!1,q,"Обновить")})),e.target.reset(),L(i)})),b.addEventListener("submit",(function(e){var t;d(!0,b,"Сохранить"),e.preventDefault(),m.textContent=v.value,p.textContent=y.value,(t={name:m.textContent,about:p.textContent},fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:t.name,about:t.about})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).catch((function(e){return console.log(e)})).finally((function(){d(!1,b,"Сохранить")})),L(n)})),r.addEventListener("click",(function(){return k(e)})),c.addEventListener("click",(function(){k(n),v.value=m.textContent,y.value=p.textContent})),u.addEventListener("click",(function(){return k(i)})),o.addEventListener("submit",(function(t){var n,o;d(!0,S,"Создать"),t.preventDefault(),(n=C.value,o=j.value,fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){P.prepend(U(e))})).catch((function(e){return console.log(e)})).finally((function(){return d(!1,S,"Создать")})),L(e),a.classList.add("form__submit-button_inactive"),a.disabled=!0,t.target.reset()})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&L(e),t.target.classList.contains("popup__close-button")&&L(e)}))})),A={fieldset:".form__input-container",formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_inactive",inputErrorClass:"form__item_type_error",errorClass:"form__input-error_active"},Array.from(document.querySelectorAll(A.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(e.querySelectorAll(A.fieldset)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);T(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid&&0!==t.length?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),T(n,o,t)}))}))}(e,A)}))})),fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){m.textContent=e.name,p.textContent=e.about,s.src=e.avatar})).catch((function(e){return console.log(e)})),fetch("".concat(l.baseUrl,"/cards"),{headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){Array.from(e).forEach((function(e){P.append(U(e))}))})).catch((function(e){return console.log(e)}))})();